<!DOCTYPE html>

<html lang="en">

<head>

  <title>Quin Jump King Progress</title>

  <meta charset="UTF-8" />

  <meta name="viewport" content="width=device-width,initial-scale=1" />

  <meta name="description" content="Track quins jump king progress" />

  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

  <link rel="icon" href="favicon.gif">
</head>

<body>

  <h1>Quins Jump King Progress</h1>
  <a href="#how">How this works</a>

<select name="date" id="date" onchange="draw_basic(this)">
</select>

  <div id="chart_div"></div>


<div class="container">
<h2 id="how">How this works</h2>
<p>tldr: machine learning detects screens in images</p>
<p>I took a speedrun of jump king and extracted about 5 seconds for each screen. From this I extracted the frames for further processing.<p>
<p>To reduce the complexity the images are resized to 40x22 pixels and the edges are detected. This reduces the information of each image from 1920*1080*255*255*255 = 34383139200000 (pixels * rgb information) to 40*22*2 = 1760 (pixels * black or white).</p>
<p>Below are examples of what the machine learning models sees.</p>
<p>Screen 20</p>
<img src="images/screen20/1.jpg" alt="jump king screen 20">
<img src="images/screen20/2.jpg" alt="jump king screen 20">
<img src="images/screen20/3.jpg" alt="jump king screen 20">
<p>Screen 11</p>
<img src="images/screen11/1.jpg" alt="jump king screen 11">
<img src="images/screen11/2.jpg" alt="jump king screen 11">
<img src="images/screen11/3.jpg" alt="jump king screen 11">
<p>As you can see there are clear differences between different screens. These differences can also be detected by machine learning models.</p>
<p>Actually I am using 5 different machine learning models. Quin often has stuff on screen (donos, rolls, browser window due to stalling) which is obviously not included in the learning data from the speedrun. I noticed when using a single model that it would get confused and miss classify images despite having over 99% accuracy on frames from the speedrun. So I just use 5 models and let them each classify images independently. If 4 or more agree on a screen then that probably true.<p>
<p>The rest is just applying the preductions to the streams and plotting the results.</p>
</div>
</body>
<style>
.container {
    width: 80em;
}
</style>
<script>
google.charts.load('current', {packages: ['corechart', 'line']});
google.charts.setOnLoadCallback(draw_basic);

function draw_basic() {
    let d = document.getElementById("date").value;

    var data = new google.visualization.DataTable();
    data.addColumn('number', 'Progress');
    data.addColumn('number', 'Percentage');

    data.addRows(get_data(d));

    var options = {
        hAxis: {
            title: 'Time (10s interval)'
        },
        width: document.body.offsetWidth,
        height: 900,
        explorer: { axis: 'horizontal' },
        vAxis: {
            title: 'progress',
            viewWindowMode:'explicit',
            viewWindow: {
              max:100,
              min:0,
            }
        }
    };

    var chart = new google.visualization.LineChart(document.getElementById('chart_div'));

    chart.draw(data, options);
}

function get_data(d) {
    if (window.data === undefined) {
        return [[0,0],[1,10],[2,20],[3,40]];
    }
    let data_array = window.data[d];
    let chart_array = [];
    for (var i = 0; i < data_array.length; ++i) {
        let percent = Math.ceil((data_array[i]-1) / 42 * 100);
        chart_array.push([i, percent]);
    }
    return chart_array;
}

function init(data) {
    for (key of Object.keys(data)) {
        let option = document.createElement("option");
        option.innerText = key;
        option.value = key;
        document.getElementById("date").appendChild(option);
    }
    window.data = data;
    draw_basic();
}

var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
    if (this.readyState == 4 && this.status == 200) {
        var data = JSON.parse(this.responseText);
        init(data)
    }
};
xhr.open("GET", "data.json", true);
xhr.send();
</script>

</html>
